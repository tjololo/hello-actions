name: Close issue on move to done

on:
  project_card:
    types: [moved]

jobs:
  close-issue:
    runs-on: ubuntu-latest

    steps:
    - name: Check if card is moved to done
      if: ${{ github.event.project_card.column_name == 'Done' }}
      run: |
        echo "Card is moved to Done, closing issue"

    - name: Close issue
      run: |
        ISSUE_NUMBER=${{ github.event.project_card.content_url | regex_replace("^.*\/(.*)$", "$1") }}
        echo "Closing issue $ISSUE_NUMBER"
        curl -X PATCH -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" -d '{"state":"closed"}' https://api.github.com/repos/${{ github.repository }}/issues/$ISSUE_NUMBER
