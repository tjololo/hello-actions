name: Test composite
description: Tun a composite pipeline
inputs:
  working_directory:
    description: The directory where the Terraform project is located.
    default: ./TestData
    required: true
  test_input:
    description: test input
    default: test
    required: true
  gh_token:
    description: GitHub Token
    required: true

runs:
  using: composite
  steps:
    - name: Terraform Summary
      id: action_summary
      if: always()
      env:
        VALIDATE_OUTPUT: ${{ steps.validate.outputs.stdout }}
        PLAN_OUTPUT: ${{ steps.plan.outputs.stdout }}
      working-directory: ${{ inputs.working_directory }}
      uses: actions/github-script@v7
      with:
        github-token: ${{ inputs.gh_token }}
        script: |
          // 1. Prep the output
          const output = `# Summary
          Testing a summary`;
          
          // 2. Set the output variable
          const fs = require('fs');
          fs.writeFileSync('${{ inputs.working_directory }}/summary.md', output);
          core.setOutput('summary', output);
    - name: Write the step summary
      if: always()
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      run: cat summary.md >> $GITHUB_STEP_SUMMARY